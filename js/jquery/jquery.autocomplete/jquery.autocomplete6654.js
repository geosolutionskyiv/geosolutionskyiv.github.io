!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";var t={extend:function(t,n){return e.extend(t,n)},createNode:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}},n=27,s=9,i=13,o=38,l=40;function a(t,n){var s=function(){},i=this,o={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:200,params:{searchtype:"caption"},formatResult:a.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:s,onSearchComplete:s,containerClass:"autocomplete",tabDisabled:!1,dataType:"text",lookupFilter:function(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)},paramName:"q",transformResult:function(t){return"string"==typeof t?e.parseJSON(t):t}};i.element=t,i.el=e(t),i.suggestions=[],i.badQueries=[],i.selectedIndex=-1,i.currentValue=i.element.value,i.intervalId=0,i.cachedResponse=[],i.onChangeInterval=null,i.onChange=null,i.ignoreValueChange=!1,i.isLocal=!1,i.suggestionsContainer=null,i.options=e.extend({},o,n),i.classes={selected:"autocomplete-selected",suggestion:"found-item"},i.initialize(),i.setOptions(n)}a.utils=t,e.Autocomplete=a,a.formatResult=function(e,t){return'<td><img src="/'+e.img+'" align=absmiddle></td><td>'+e.name+"</td>"},a.prototype={killerFn:null,initialize:function(){var t,n=this,s="."+n.classes.suggestion,i=n.classes.selected,o=n.options;n.element.setAttribute("autocomplete","off"),n.killerFn=function(t){0===e(t.target).closest("."+n.options.containerClass).length&&(n.killSuggestions(),n.disableKillerFn())},n.suggestionsContainer=a.utils.createNode('<div class="'+o.containerClass+'" style="position: absolute; display: none;"></div>'),(t=e(n.suggestionsContainer)).appendTo(o.appendTo),"auto"!==o.width&&t.width(o.width),t.on("mouseover.autocomplete",s,function(){n.activate(e(this).data("index"))}),t.on("mouseout.autocomplete",function(){n.selectedIndex=-1,t.children("."+i).removeClass(i)}),t.on("click.autocomplete",s,function(){n.select(e(this).data("index"),!1)}),n.fixPosition(),n.el.on("keydown.autocomplete",function(e){n.onKeyPress(e)}),n.el.on("keyup.autocomplete",function(e){n.onKeyUp(e)}),n.el.on("blur.autocomplete",function(){n.onBlur()}),n.el.on("focus.autocomplete",function(){n.fixPosition()})},onBlur:function(){this.enableKillerFn()},setOptions:function(n){var s=this,i=s.options;t.extend(i,n),s.isLocal=e.isArray(i.lookup),s.isLocal&&(i.lookup=s.verifySuggestionsFormat(i.lookup)),e(s.suggestionsContainer).css({"max-height":i.maxHeight+"px",width:i.width+"px","z-index":i.zIndex})},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue=null,this.suggestions=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var t,n=this;"body"===n.options.appendTo&&(t=n.el.offset(),e(n.suggestionsContainer).css({top:t.top+n.el.outerHeight()+"px",left:t.left+"px"}))},enableKillerFn:function(){e(document).on("click.autocomplete",this.killerFn)},disableKillerFn:function(){e(document).off("click.autocomplete",this.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(e){var t=this;if(t.disabled||t.visible||e.keyCode!==l||!t.currentValue){if(!t.disabled&&t.visible){switch(e.keyCode){case n:t.el.val(t.currentValue),t.hide();break;case s:case i:if(-1===t.selectedIndex)return void t.hide();if(t.select(t.selectedIndex,e.keyCode===i),e.keyCode===s&&!1===this.options.tabDisabled)return;break;case o:t.moveUp();break;case l:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}}else t.suggest()},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.keyCode){case o:case l:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var e,t=this;clearInterval(t.onChangeInterval),t.currentValue=t.element.value,e=t.getQuery(t.currentValue),t.selectedIndex=-1,t.ignoreValueChange?t.ignoreValueChange=!1:e.length<t.options.minChars?t.hide():t.getSuggestions(e)},getQuery:function(t){var n,s=this.options.delimiter;return s?(n=t.split(s),e.trim(n[n.length-1])):e.trim(t)},getSuggestionsLocal:function(t){var n=t.toLowerCase(),s=this.options.lookupFilter;return{suggestions:e.grep(this.options.lookup,function(e){return s(e,t,n)})}},getSuggestions:function(t){var n,s=this,i=s.options,o=i.serviceUrl;if((n=s.isLocal?s.getSuggestionsLocal(t):s.cachedResponse[t])&&e.isArray(n.suggestions))s.suggestions=n.suggestions,s.suggest();else if(!s.isBadQuery(t)){if(i.params[i.paramName]=t,!1===i.onSearchStart.call(s.element,i.params))return;e.isFunction(i.serviceUrl)&&(o=i.serviceUrl.call(s.element,t)),e.ajax({url:o,data:i.ignoreParams?null:i.params,type:i.type,dataType:i.dataType}).done(function(e){s.processResponse(e,t),i.onSearchComplete.call(s.element,t)})}},isBadQuery:function(e){for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var t=this;t.visible=!1,t.selectedIndex=-1,e(t.suggestionsContainer).hide()},suggest:function(){if(0!==this.suggestions.length){var t,n=this,s=n.options.formatResult,i=n.getQuery(n.currentValue),o=n.classes.suggestion,l=n.classes.selected,a=e(n.suggestionsContainer),r="";e.each(n.suggestions,function(e,t){r+='<div class="'+o+'" data-index="'+e+'"><table><tr>'+s(t,i)+"</tr></table></div>"}),"auto"===n.options.width&&(t=n.el.outerWidth()-2,a.width(t>0?t:300)),a.html(r).show(),n.visible=!0,n.options.autoSelectFirst&&(n.selectedIndex=0,a.children().first().addClass(l))}else this.hide()},verifySuggestionsFormat:function(t){return t.length&&"string"==typeof t[0]?e.map(t,function(e){return{value:e,data:null}}):t},processResponse:function(e,t){var n=this,s=n.options,i=s.transformResult(e,t);i.suggestions=n.verifySuggestionsFormat(i.suggestions),s.noCache||(n.cachedResponse[i[s.paramName]]=i,0===i.suggestions.length&&n.badQueries.push(i[s.paramName])),t===n.getQuery(n.currentValue)&&(n.suggestions=i.suggestions,n.suggest())},activate:function(t){var n,s=this,i=s.classes.selected,o=e(s.suggestionsContainer),l=o.children();return o.children("."+i).removeClass(i),s.selectedIndex=t,-1!==s.selectedIndex&&l.length>s.selectedIndex?(n=l.get(s.selectedIndex),e(n).addClass(i),n):null},select:function(e,t){this.el.val(this.suggestions[e].name),this.el.next("a").trigger("onclick")},moveUp:function(){var t=this;if(-1!==t.selectedIndex)return 0===t.selectedIndex?(e(t.suggestionsContainer).children().first().removeClass(t.classes.selected),t.selectedIndex=-1,void t.el.val(t.currentValue)):void t.adjustScroll(t.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(t){var n,s,i,o=this,l=o.activate(t);l&&(n=l.offsetTop,i=(s=e(o.suggestionsContainer).scrollTop())+o.options.maxHeight-25,n<s?e(o.suggestionsContainer).scrollTop(n):n>i&&e(o.suggestionsContainer).scrollTop(n-o.options.maxHeight+25),o.el.val(o.getValue(o.suggestions[t].value)))},onSelect:function(t){var n=this,s=n.options.onSelect,i=n.suggestions[t];n.el.val(n.getValue(i.value)),e.isFunction(s)&&s.call(n.element,i)},getValue:function(e){var t,n,s=this.options.delimiter;return s?1===(n=(t=this.currentValue).split(s)).length?e:t.substr(0,t.length-n[n.length-1].length)+e:e},dispose:function(){var t=this;t.el.off(".autocomplete").removeData("autocomplete"),t.disableKillerFn(),e(t.suggestionsContainer).remove()}},e.fn.autocomplete=function(t,n){var s="autocomplete";return 0===arguments.length?this.first().data(s):this.each(function(){var i=e(this),o=i.data(s);"string"==typeof t?o&&"function"==typeof o[t]&&o[t](n):(o&&o.dispose&&o.dispose(),o=new a(this,t),i.data(s,o))})}});