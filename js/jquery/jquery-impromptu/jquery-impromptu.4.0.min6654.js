!function(t){t.prompt=function(p,o){t.prompt.options=t.extend({},t.prompt.defaults,o),t.prompt.currentPrefix=t.prompt.options.prefix,t.prompt.currentStateName="";var e=t.browser.msie&&t.browser.version<7,r=t(document.body),i=t(window);t.prompt.options.classes=t.trim(t.prompt.options.classes),""!=t.prompt.options.classes&&(t.prompt.options.classes=" "+t.prompt.options.classes);var n='<div class="'+t.prompt.options.prefix+"box"+t.prompt.options.classes+'" id="'+t.prompt.options.prefix+'box">';t.prompt.options.useiframe&&(t("object, applet").length>0||e)?n+='<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+t.prompt.options.prefix+'fade" id="'+t.prompt.options.prefix+'fade"></iframe>':(e&&t("select").css("visibility","hidden"),n+='<div class="'+t.prompt.options.prefix+'fade" id="'+t.prompt.options.prefix+'fade"></div>'),n+='<div class="'+t.prompt.options.prefix+'" id="'+t.prompt.options.prefix+'"><div class="'+t.prompt.options.prefix+'container"><div class="',n+=t.prompt.options.prefix+'close">X</div><div id="'+t.prompt.options.prefix+'states"></div>',n+="</div></div></div>",t.prompt.jqib=t(n).appendTo(r),t.prompt.jqi=t.prompt.jqib.children("#"+t.prompt.options.prefix),t.prompt.jqif=t.prompt.jqib.children("#"+t.prompt.options.prefix+"fade"),p.constructor==String&&(p={state0:{html:p,buttons:t.prompt.options.buttons,focus:t.prompt.options.focus,submit:t.prompt.options.submit}});var s="";t.each(p,function(o,e){e=t.extend({},t.prompt.defaults.state,e),p[o]=e;var r="";null!==e.position.arrow&&(r='<div class="'+t.prompt.options.prefix+"arrow "+t.prompt.options.prefix+"arrow"+e.position.arrow+'"></div>'),s+='<div id="'+t.prompt.options.prefix+"_state_"+o+'" class="'+t.prompt.options.prefix+'_state" style="display:none;">'+r+'<div class="'+t.prompt.options.prefix+'message">'+e.html+'</div><div class="'+t.prompt.options.prefix+'buttons">',t.each(e.buttons,function(p,e){s+="object"==typeof e?'<button name="'+t.prompt.options.prefix+"_"+o+"_button"+e.title.replace(/[^a-z0-9]+/gi,"")+'" id="'+t.prompt.options.prefix+"_"+o+"_button"+e.title.replace(/[^a-z0-9]+/gi,"")+'" value="'+e.value+'">'+e.title+"</button>":'<button name="'+t.prompt.options.prefix+"_"+o+"_button"+p+'" id="'+t.prompt.options.prefix+"_"+o+"_button"+p+'" value="'+e+'">'+p+"</button>"}),s+="</div></div>"}),t.prompt.states=p,t.prompt.jqi.find("#"+t.prompt.options.prefix+"states").html(s).children("."+t.prompt.options.prefix+"_state:first").css("display","block"),t.prompt.jqi.find("."+t.prompt.options.prefix+"buttons:empty").css("display","none"),t.each(p,function(p,o){var e=t.prompt.jqi.find("#"+t.prompt.options.prefix+"_state_"+p);""===t.prompt.currentStateName&&(t.prompt.currentStateName=p),e.bind("promptsubmit",o.submit),e.children("."+t.prompt.options.prefix+"buttons").children("button").click(function(){var r=e.children("."+t.prompt.options.prefix+"message"),i=o.buttons[t(this).text()];if(null==i)for(var n in o.buttons)o.buttons[n].title==t(this).text()&&(i=o.buttons[n].value);"object"==typeof i&&(i=i.value);var s={};t.each(t.prompt.jqi.find("#"+t.prompt.options.prefix+"states :input").serializeArray(),function(t,p){void 0===s[p.name]?s[p.name]=p.value:typeof s[p.name]==Array||"object"==typeof s[p.name]?s[p.name].push(p.value):s[p.name]=[s[p.name],p.value]});var a=new t.Event("promptsubmit");a.stateName=p,a.state=e,e.trigger(a,[i,r,s]),a.isDefaultPrevented()||t.prompt.close(!0,i,r,s)}),e.find("."+t.prompt.options.prefix+"buttons button:eq("+o.focus+")").addClass(t.prompt.options.prefix+"defaultbutton")});var a=function(){if(t.prompt.options.persistent){var p=t.prompt.options.top.toString().indexOf("%")>=0?i.height()*(parseInt(t.prompt.options.top,10)/100):parseInt(t.prompt.options.top,10),o=parseInt(t.prompt.jqi.css("top").replace("px",""),10)-p;t("html,body").animate({scrollTop:o},"fast",function(){var p=0;t.prompt.jqib.addClass(t.prompt.options.prefix+"warning");var o=setInterval(function(){t.prompt.jqib.toggleClass(t.prompt.options.prefix+"warning"),p++>1&&(clearInterval(o),t.prompt.jqib.removeClass(t.prompt.options.prefix+"warning"))},100)})}else t.prompt.close(!0)};return t.prompt.position(),t.prompt.style(),t.prompt.jqif.click(a),i.resize({animate:!1},t.prompt.position),t.prompt.jqib.bind("keydown keypress",function(p){var o=window.event?event.keyCode:p.keyCode;if(27==o&&a(),9==o){var e=t(":input:enabled:visible",t.prompt.jqib),r=!p.shiftKey&&p.target==e[e.length-1],i=p.shiftKey&&p.target==e[0];if(r||i)return setTimeout(function(){if(e){var t=e[!0===i?e.length-1:0];t&&t.focus()}},10),!1}}),t.prompt.jqi.find("."+t.prompt.options.prefix+"close").click(t.prompt.close),t.prompt.jqib.bind("promptloaded",t.prompt.options.loaded),t.prompt.jqib.bind("promptclose",t.prompt.options.callback),t.prompt.jqib.bind("promptstatechanging",t.prompt.options.statechanging),t.prompt.jqib.bind("promptstatechanged",t.prompt.options.statechanged),t.prompt.jqif.fadeIn(t.prompt.options.overlayspeed),t.prompt.jqi[t.prompt.options.show](t.prompt.options.promptspeed,function(){t.prompt.jqib.trigger("promptloaded")}),t.prompt.jqi.find("#"+t.prompt.options.prefix+"states ."+t.prompt.options.prefix+"_state:first ."+t.prompt.options.prefix+"defaultbutton").focus(),t.prompt.options.timeout>0&&setTimeout(t.prompt.close,t.prompt.options.timeout),t.prompt.jqib},t.prompt.defaults={prefix:"jqi",classes:"",buttons:{Ok:!0},loaded:function(t){},submit:function(t,p,o,e){},callback:function(t,p,o,e){},statechanging:function(t,p,o){},statechanged:function(t,p){},opacity:.6,zIndex:999,overlayspeed:"slow",promptspeed:"fast",show:"fadeIn",focus:0,useiframe:!1,top:"15%",persistent:!0,timeout:0,state:{html:"",buttons:{Ok:!0},focus:0,position:{container:null,x:null,y:null,arrow:null},submit:function(t,p,o,e){return!0}}},t.prompt.currentPrefix=t.prompt.defaults.prefix,t.prompt.currentStateName="",t.prompt.setDefaults=function(p){t.prompt.defaults=t.extend({},t.prompt.defaults,p)},t.prompt.setStateDefaults=function(p){t.prompt.defaults.state=t.extend({},t.prompt.defaults.state,p)},t.prompt.position=function(p){var o=t.fx.off,e=t(window),r=t(document.body).outerHeight(!0),i=t(window).height(),n=(t(document).height(),r>i?r:i),s=parseInt(e.scrollTop(),10)+(t.prompt.options.top.toString().indexOf("%")>=0?i*(parseInt(t.prompt.options.top,10)/100):parseInt(t.prompt.options.top,10));if(void 0!==p&&!1===p.data.animate&&(t.fx.off=!0),t.prompt.jqib.css({position:"absolute",height:n,width:"100%",top:0,left:0,right:0,bottom:0}),t.prompt.jqif.css({position:"absolute",height:n,width:"100%",top:0,left:0,right:0,bottom:0}),null!==t.prompt.states[t.prompt.currentStateName].position.container){var a=t.prompt.states[t.prompt.currentStateName].position,m=t(a.container).offset();t.prompt.jqi.css({position:"absolute"}),t.prompt.jqi.animate({top:m.top+a.y,left:m.left+a.x,marginLeft:0,width:void 0!==a.width?a.width:null}),s=m.top+a.y-(t.prompt.options.top.toString().indexOf("%")>=0?i*(parseInt(t.prompt.options.top,10)/100):parseInt(t.prompt.options.top,10)),t("html,body").animate({scrollTop:s},"slow","swing",function(){})}else t.prompt.jqi.css({position:"absolute",top:s,left:"50%",marginLeft:t.prompt.jqi.outerWidth()/2*-1});void 0!==p&&!1===p.data.animate&&(t.fx.off=o)},t.prompt.style=function(){t.prompt.jqif.css({zIndex:t.prompt.options.zIndex,display:"none",opacity:t.prompt.options.opacity}),t.prompt.jqi.css({zIndex:t.prompt.options.zIndex+1,display:"none"}),t.prompt.jqib.css({zIndex:t.prompt.options.zIndex})},t.prompt.getStateContent=function(p){return t("#"+t.prompt.currentPrefix+"_state_"+p)},t.prompt.getCurrentState=function(){return t("."+t.prompt.currentPrefix+"_state:visible")},t.prompt.getCurrentStateName=function(){return t.prompt.getCurrentState().attr("id").replace(t.prompt.currentPrefix+"_state_","")},t.prompt.goToState=function(p,o){var e=new t.Event("promptstatechanging");t.prompt.jqib.trigger(e,[t.prompt.currentStateName,p]),e.isDefaultPrevented()||(t.prompt.currentStateName=p,t("."+t.prompt.currentPrefix+"_state").slideUp("slow").find("."+t.prompt.currentPrefix+"arrow").fadeOut(),t("#"+t.prompt.currentPrefix+"_state_"+p).slideDown("slow",function(){var e=t(this);e.find("."+t.prompt.currentPrefix+"defaultbutton").focus(),e.find("."+t.prompt.currentPrefix+"arrow").fadeIn("slow"),"function"==typeof o&&t.prompt.jqib.bind("promptstatechanged.tmp",o),t.prompt.jqib.trigger("promptstatechanged",[p]),"function"==typeof o&&t.prompt.jqib.unbind("promptstatechanged.tmp")}),t.prompt.position())},t.prompt.nextState=function(p){var o=t("#"+t.prompt.currentPrefix+"_state_"+t.prompt.currentStateName).next();t.prompt.goToState(o.attr("id").replace(t.prompt.currentPrefix+"_state_",""),p)},t.prompt.prevState=function(p){var o=t("#"+t.prompt.currentPrefix+"_state_"+t.prompt.currentStateName).prev();t.prompt.goToState(o.attr("id").replace(t.prompt.currentPrefix+"_state_",""),p)},t.prompt.close=function(p,o,e,r){t.prompt.jqib.fadeOut("fast",function(){p&&t.prompt.jqib.trigger("promptclose",[o,e,r]),t.prompt.jqib.remove(),t("window").unbind("resize",t.prompt.position),t.browser.msie&&t.browser.version<7&&!t.prompt.options.useiframe&&t("select").css("visibility","visible")})},t.fn.extend({prompt:function(p){null==p&&(p={}),null==p.withDataAndEvents&&(p.withDataAndEvents=!1),t.prompt(t(this).clone(p.withDataAndEvents).html(),p)},promptDropIn:function(p,o){var e=t(this);if("none"==e.css("display")){var r=e.css("top");e.css({top:t(window).scrollTop(),display:"block"}).animate({top:r},p,"swing",o)}}})}(jQuery);